<div class="dashboard-summary">
    <div class="summary-card" style="background-color: #fff;">
        <div class="icon" style="background-color: #e63946;">
            <i class="fas fa-calendar-day"></i>
        </div>
        <div class="info">
            <h3><%= new Intl.NumberFormat('vi-VN').format(dailyTotal) %> VND</h3>
            <p>Chi ti√™u h√¥m nay</p>
        </div>
    </div>
    <div class="summary-card" style="background-color: #fff;">
        <div class="icon" style="background-color: #4361ee;">
            <i class="fas fa-calendar-week"></i>
        </div>
        <div class="info">
            <h3><%= new Intl.NumberFormat('vi-VN').format(weeklyTotal) %> VND</h3>
            <p>Chi ti√™u tu·∫ßn n√†y</p>
        </div>
    </div>
    <div class="summary-card" style="background-color: #fff;">
        <div class="icon" style="background-color: #38b000;">
            <i class="fas fa-calendar-alt"></i>
        </div>
        <div class="info">
            <h3><%= new Intl.NumberFormat('vi-VN').format(monthlyTotal) %> VND</h3>
            <p>Chi ti√™u th√°ng n√†y</p>
        </div>
    </div>
    <div class="summary-card" style="background-color: #fff;">
        <div class="icon" style="background-color: #ff9e00;">
            <i class="fas fa-calendar"></i>
        </div>
        <div class="info">
            <h3><%= new Intl.NumberFormat('vi-VN').format(yearlyTotal) %> VND</h3>
            <p>Chi ti√™u nƒÉm nay</p>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2><i class="fas fa-chart-pie"></i> Th·ªëng k√™ chi ti√™u</h2>
        <div class="stats-nav">
            <a href="/statistics/daily" class="btn"><i class="fas fa-calendar-day"></i> Ng√†y</a>
            <a href="/statistics/weekly" class="btn"><i class="fas fa-calendar-week"></i> Tu·∫ßn</a>
            <a href="/statistics/monthly" class="btn"><i class="fas fa-calendar-alt"></i> Th√°ng</a>
            <a href="/statistics/yearly" class="btn"><i class="fas fa-calendar"></i> NƒÉm</a>
        </div>
    </div>

    <div class="stats-overview">
        <div class="chart-container">
            <h3>Chi ti√™u theo th√°ng trong nƒÉm <%= new Date().getFullYear() %></h3>
            <canvas id="monthlyChart"></canvas>
        </div>

        <div class="category-distribution">
            <h3>Ph√¢n b·ªë chi ti√™u theo danh m·ª•c (th√°ng hi·ªán t·∫°i)</h3>
            <div class="pie-chart-container">
                <canvas id="categoryPieChart"></canvas>
            </div>
            <div class="category-list">
                <% categoryTotals.forEach(category => { %>
                    <div class="category-item">
                        <div class="category-name">
                            <span class="category-badge">
                                <% if (category.category === 'ƒÇn u·ªëng') { %>
                                    üçï
                                <% } else if (category.category === 'Di chuy·ªÉn') { %>
                                    üöó
                                <% } else if (category.category === 'Mua s·∫Øm') { %>
                                    üõí
                                <% } else if (category.category === 'H√≥a ƒë∆°n') { %>
                                    üìÑ
                                <% } else if (category.category === 'Gi·∫£i tr√≠') { %>
                                    üéÆ
                                <% } else { %>
                                    üìå
                                <% } %>
                                <%= category.category %>
                            </span>
                        </div>
                        <div class="category-amount"><%= new Intl.NumberFormat('vi-VN').format(category.total) %> VND</div>
                        <div class="category-percent"><%= ((category.total / monthlyTotal) * 100).toFixed(1) %>%</div>
                    </div>
                <% }); %>
            </div>
        </div>
    </div>
</div>

<script>
    // Bi·ªÉu ƒë·ªì chi ti√™u theo th√°ng
    const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
    const monthlyData = <%= chartData %>;
    
    new Chart(monthlyCtx, {
        type: 'bar',
        data: monthlyData,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            responsive: true,
            maintainAspectRatio: false
        }
    });
    
    // Bi·ªÉu ƒë·ªì ph√¢n b·ªë chi ti√™u theo danh m·ª•c
    const categoryCtx = document.getElementById('categoryPieChart').getContext('2d');
    const categoryData = {
        labels: [<% categoryTotals.forEach(category => { %>'<%= category.category %>', <% }); %>],
        datasets: [{
            data: [<% categoryTotals.forEach(category => { %><%= category.total %>, <% }); %>],
            backgroundColor: [
                'rgba(255, 99, 132, 0.7)',
                'rgba(54, 162, 235, 0.7)',
                'rgba(255, 206, 86, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(153, 102, 255, 0.7)',
                'rgba(255, 159, 64, 0.7)',
                'rgba(201, 203, 207, 0.7)'
            ],
            borderWidth: 1
        }]
    };
    
    new Chart(categoryCtx, {
        type: 'doughnut',
        data: categoryData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                }
            }
        }
    });
</script>

<style>
    .stats-nav {
        display: flex;
        gap: 0.5rem;
    }
    
    .stats-overview {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        margin-top: 2rem;
    }
    
    .chart-container {
        flex: 1;
        min-width: 300px;
        height: 400px;
    }
    
    .category-distribution {
        flex: 1;
        min-width: 300px;
    }
    
    .pie-chart-container {
        height: 250px;
        margin-bottom: 1.5rem;
    }
    
    .category-list {
        max-height: 300px;
        overflow-y: auto;
    }
    
    .category-item {
        display: flex;
        justify-content: space-between;
        padding: 0.75rem 0;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .category-name {
        flex: 2;
    }
    
    .category-amount {
        flex: 1;
        text-align: right;
    }
    
    .category-percent {
        flex: 0 0 60px;
        text-align: right;
        font-weight: 500;
    }
    
    h3 {
        margin-bottom: 1.5rem;
        color: var(--dark-color);
        font-size: 1.2rem;
    }
    
    @media (max-width: 768px) {
        .stats-nav {
            flex-wrap: wrap;
        }
        
        .stats-overview {
            flex-direction: column;
        }
    }
</style>
