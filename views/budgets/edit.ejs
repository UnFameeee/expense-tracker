<div class="card">
    <div class="card-header">
        <h2><i class="fas fa-edit"></i> Ch·ªânh s·ª≠a ng√¢n s√°ch</h2>
    </div>

    <form action="/budgets/<%= budget.id %>?_method=PUT" method="POST" class="expense-form">
        <div class="form-row">
            <div class="form-group">
                <label for="month"><i class="fas fa-calendar-month"></i> Th√°ng:</label>
                <select id="month" name="month" required>
                    <option value="1" <%= budget.month === 1 ? 'selected' : '' %>>Th√°ng 1</option>
                    <option value="2" <%= budget.month === 2 ? 'selected' : '' %>>Th√°ng 2</option>
                    <option value="3" <%= budget.month === 3 ? 'selected' : '' %>>Th√°ng 3</option>
                    <option value="4" <%= budget.month === 4 ? 'selected' : '' %>>Th√°ng 4</option>
                    <option value="5" <%= budget.month === 5 ? 'selected' : '' %>>Th√°ng 5</option>
                    <option value="6" <%= budget.month === 6 ? 'selected' : '' %>>Th√°ng 6</option>
                    <option value="7" <%= budget.month === 7 ? 'selected' : '' %>>Th√°ng 7</option>
                    <option value="8" <%= budget.month === 8 ? 'selected' : '' %>>Th√°ng 8</option>
                    <option value="9" <%= budget.month === 9 ? 'selected' : '' %>>Th√°ng 9</option>
                    <option value="10" <%= budget.month === 10 ? 'selected' : '' %>>Th√°ng 10</option>
                    <option value="11" <%= budget.month === 11 ? 'selected' : '' %>>Th√°ng 11</option>
                    <option value="12" <%= budget.month === 12 ? 'selected' : '' %>>Th√°ng 12</option>
                </select>
            </div>

            <div class="form-group">
                <label for="year"><i class="fas fa-calendar-year"></i> NƒÉm:</label>
                <input type="number" id="year" name="year" value="<%= budget.year %>" min="2020" max="2100" required>
            </div>
        </div>

        <div class="form-group">
            <label for="base_salary"><i class="fas fa-money-bill-wave"></i> L∆∞∆°ng c∆° b·∫£n (VND):</label>
            <input type="number" id="base_salary" name="base_salary" step="100000" min="0" value="<%= budget.base_salary %>" placeholder="Nh·∫≠p l∆∞∆°ng c∆° b·∫£n" required>
            <span id="formatted-salary"><%= new Intl.NumberFormat('vi-VN').format(budget.base_salary) %> VND</span>
        </div>

        <div class="form-group">
            <label for="savings_goal"><i class="fas fa-piggy-bank"></i> M·ª•c ti√™u ti·∫øt ki·ªám (VND):</label>
            <input type="number" id="savings_goal" name="savings_goal" step="100000" min="0" value="<%= budget.savings_goal %>" placeholder="Nh·∫≠p m·ª•c ti√™u ti·∫øt ki·ªám" required>
            <span id="formatted-savings"><%= new Intl.NumberFormat('vi-VN').format(budget.savings_goal) %> VND</span>
        </div>

        <div class="category-limits">
            <h3><i class="fas fa-tags"></i> Gi·ªõi h·∫°n chi ti√™u theo danh m·ª•c</h3>
            <p class="hint">Thi·∫øt l·∫≠p gi·ªõi h·∫°n chi ti√™u t·ªëi ƒëa cho m·ªói danh m·ª•c trong th√°ng</p>
            
            <% categories.forEach(category => { %>
                <div class="form-group">
                    <label for="limit_<%= category %>">
                        <% if (category === 'ƒÇn u·ªëng') { %>
                            üçï
                        <% } else if (category === 'Di chuy·ªÉn') { %>
                            üöó
                        <% } else if (category === 'Mua s·∫Øm') { %>
                            üõí
                        <% } else if (category === 'H√≥a ƒë∆°n') { %>
                            üìÑ
                        <% } else if (category === 'Gi·∫£i tr√≠') { %>
                            üéÆ
                        <% } else { %>
                            üìå
                        <% } %>
                        <%= category %>:
                    </label>
                    <input type="number" id="limit_<%= category %>" name="limit_<%= category %>" step="10000" min="0" value="<%= budget.category_limits[category] || 0 %>" placeholder="Gi·ªõi h·∫°n cho <%= category %>">
                    <span id="formatted-limit-<%= category.replace(/\s+/g, '-').toLowerCase() %>"><%= new Intl.NumberFormat('vi-VN').format(budget.category_limits[category] || 0) %> VND</span>
                </div>
            <% }); %>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> C·∫≠p nh·∫≠t</button>
            <a href="/budgets" class="btn"><i class="fas fa-times"></i> H·ªßy</a>
        </div>
    </form>
</div>

<script>
    // Hi·ªáu ·ª©ng focus cho input
    document.querySelectorAll('input, select').forEach(input => {
        input.addEventListener('focus', () => {
            input.parentElement.classList.add('focused');
        });
        
        input.addEventListener('blur', () => {
            input.parentElement.classList.remove('focused');
        });
    });

    // Format s·ªë ti·ªÅn khi nh·∫≠p
    const formatAmount = (inputId, outputId) => {
        const input = document.getElementById(inputId);
        const output = document.getElementById(outputId);
        
        input.addEventListener('input', function() {
            const value = this.value.replace(/,/g, '');
            if (value) {
                const formattedValue = new Intl.NumberFormat('vi-VN').format(value);
                output.textContent = formattedValue + ' VND';
            } else {
                output.textContent = '';
            }
        });
    };

    formatAmount('base_salary', 'formatted-salary');
    formatAmount('savings_goal', 'formatted-savings');
    
    // Format gi·ªõi h·∫°n danh m·ª•c
    <% categories.forEach(category => { %>
        formatAmount('limit_<%= category %>', 'formatted-limit-<%= category.replace(/\s+/g, '-').toLowerCase() %>');
    <% }); %>
</script>

<style>
    .form-group.focused label {
        color: var(--primary-color);
    }
    
    #formatted-salary, #formatted-savings, [id^="formatted-limit-"] {
        display: block;
        margin-top: 5px;
        font-weight: 500;
        color: var(--primary-color);
    }
    
    .form-row {
        display: flex;
        gap: 1rem;
    }
    
    .form-row .form-group {
        flex: 1;
    }
    
    .category-limits {
        margin-top: 2rem;
        padding: 1.5rem;
        background-color: #f8fafc;
        border-radius: var(--border-radius);
        border: 1px solid #e2e8f0;
    }
    
    .category-limits h3 {
        margin-bottom: 1rem;
        color: var(--dark-color);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .hint {
        color: var(--text-muted);
        margin-bottom: 1.5rem;
        font-size: 0.9rem;
    }
</style>
